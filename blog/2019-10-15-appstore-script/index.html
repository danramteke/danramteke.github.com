<!DOCTYPE html><html lang="en"><head>
    
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="geo.placename" content="New York City">
    <meta name="geo.region" content="US-NY">
    <meta name="description" content="Freelance iOS App Developer for New York City">
    <meta name="keywords" content="nyc, new york city, ios, swift, iphone, developer, programmer, engineer, freelance, contractor, devops, kubernetes, digitalocean, docker, terraform">
    <meta name="author" content="Dan Ramteke">
    <title>Dan Ramteke iOS, DevOps, and web development in New York City</title>

<link rel="stylesheet" href="../../assets/2012-09-04-git-branch-in-command-line.c141b363.css">
</head>
<body class="bg-dr-gray-9">

<div class="mx-auto container p-4">
<div class="container mb-8">

    <div class="pb-4 border-solid border-dr-blue-1 border-b">
    <a href="/" class="no-underline">
        <h1 class="text-dr-blue-1 text-4xl font-medium inline mr-2">Dan Ramteke</h1> 
        <h2 class="text-dr-gray-5 text-2xl inline ">
        Complete app expertise: iOS, 
        DevOps, &amp; web 
        </h2>
        </a>
    </div>
</div><div class="text-3xl font-bold pb-4">Automating Your Upload to Testflight in 4 Easy Steps</div><div class="blog-post astro-CFTPTCZT">
 <h2 id="motivation">Motivation</h2><p>I was working on a project for a client where I was wrapping their website into a <code data-astro-raw="">WKWebView</code> in order to provide native BlueTooth access.
I of course wanted to automate uploading to the App Store, and typically I would just use Fastlane, but this client
doesn’t have iOS devs, and they most likely have no interest in keeping Fastlane’s gem up to date, and very likely have no interest in keeping
Ruby up to date since they weren’t using Ruby for anything else.</p><p>And personally, my projects don’t have Ruby backends either now that I’ve moved to Server-side Swift. So I don’t want to deal with Ruby if possible, either.</p><p>So I looked into how to automatically upload to TestFlight without Fastlane, and it was much easier than I expected. It was embarrassingly easier than I expected. It’s 4 commands.</p><h2 id="its-only-four-commands">It’s only four commands</h2><p>The four steps are:</p><ol>
<li>Update build number</li>
<li>Archive project</li>
<li>Export the archive</li>
<li>Upload the exported <code data-astro-raw="">.ipa</code></li>
</ol><p>There’s a little bit of housekeeping around that: making a temporary directory to store the build artifacts. I chose <code data-astro-raw="">.build</code> here, but of course you can choose whatever you like.</p><h2 id="the-script-appstoresh">The script: appstore.sh</h2><pre class="language-null"><code data-astro-raw="" class="language-null">#!/bin/bash

if [ -z $APP_LOADER_USERNAME ]; then
  echo "need app loader username stored in \$APP_LOADER_USERNAME"
  exit 1
fi

if [ -z $APP_LOADER_PASSWORD ]; then
  echo "need app loader password stored in \$APP_LOADER_PASSWORD\nGenerate an app-specific password at appleid.apple.com"
  exit 1
fi

function version_bump {
  xcrun agvtool next-version -all
}

function archive_project {
  xcodebuild -project ExampleApp.xcodeproj -scheme ExampleApp \
    -sdk iphoneos archive -archivePath ./.build/ExampleApp.xcarchive  \
    -allowProvisioningUpdates -allowProvisioningDeviceRegistration
}

function export_archive {
  xcodebuild -exportArchive -archivePath ./.build/ExampleApp.xcarchive \
    -exportOptionsPlist appstore-export-options.plist \
    -exportPath ./.build \
    -allowProvisioningUpdates -allowProvisioningDeviceRegistration
}

function upload {
  echo "=== uploading ExampleApp to App Store ===" &amp;&amp; \
  xcrun altool --upload-app -t ios \
    -f ./.build/ExampleApp.ipa \
    -u $APP_LOADER_USERNAME -p $APP_LOADER_PASSWORD &amp;&amp; \
  echo "Uploaded ExampleApp build $(xcrun agvtool what-version -terse) of version $(xcrun agvtool what-marketing-version -terse1)"
}

mkdir -p ./.build &amp;&amp; \
version_bump &amp;&amp; \
archive_project &amp;&amp; \
export_archive &amp;&amp; \
upload</code></pre><p>You’ll also need a file with the export options. In the script above, it’s called <code data-astro-raw="">appstore-export-options.plist</code>. And you can stick it wherever.
In this example, it’s in the root directory of the project.
The file looks like this:</p><pre class="language-null"><code data-astro-raw="" class="language-null">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd"&gt;
&lt;plist version="1.0"&gt;
&lt;dict&gt;
    &lt;key&gt;method&lt;/key&gt;
    &lt;string&gt;app-store&lt;/string&gt;
    &lt;key&gt;teamID&lt;/key&gt;
    &lt;string&gt;XXXXXXXXXX&lt;/string&gt;
    &lt;key&gt;generateAppStoreInformation&lt;/key&gt;
    &lt;true/&gt;
    &lt;key&gt;uploadBitcode&lt;/key&gt;
    &lt;true/&gt;
    &lt;key&gt;uploadSymbols&lt;/key&gt;
    &lt;true/&gt;
&lt;/dict&gt;
&lt;/plist&gt;</code></pre><h2 id="personalize-the-script">Personalize the script</h2><ol>
<li>Change <code data-astro-raw="">ExampleApp.xcodeproj</code> to whatever you’re using. If you’re using a workspace, then pass along <code data-astro-raw="">-workspace ExampleWorkspace.xcworkspace</code> to the archive command.</li>
<li>Change the <code data-astro-raw="">ExampleApp</code> scheme name to whatever you’re using.</li>
<li>Change the team ID in the <code data-astro-raw="">appstore-export-options.plist</code></li>
<li>The username and password for uploading to the App Store are store in environment variables: <code data-astro-raw="">$APP_LOADER_USERNAME</code> and <code data-astro-raw="">$APP_LOADER_PASSWORD</code>.
Be sure to set them in your environment before running the script, however you store them. They are used by the app loader tool to upload the <code data-astro-raw="">.ipa</code> to Apple.
The script checks that username and password environment variables are set
at the beginning of the script so that the whole build succeeds just to find that the username and password are missing.</li>
</ol><h2 id="additional-notes">Additional notes</h2><h3 id="agvtool">agvtool</h3><p>If you want to use <code data-astro-raw="">agvtool</code> to update your build numbers, then you’ll need to enable it in your project settings.
<a href="https://medium.com/xcblog/agvtool-automating-ios-build-and-version-numbers-454cab6f1bbe">Here is a lengthy guide</a> to agvtool and how to
enable it on your project. I recommend using <code data-astro-raw="">agvtool</code> since it comes with Xcode, there’s no additional dependencies.</p><h3 id="codesign">codesign</h3><p>The first time you run this script, you may get a password prompt saying something like “codesign would like to access some keys in your keychain.”
I always hit “Always allow” so that it doesn’t bug me any more.</p><h2 id="and-thats-it">And that’s it</h2><p>Now you have a short script that builds and uploads your app to the App Store. You don’t have to worry about Ruby or Ruby Gems anymore.
And since bash is already on every Mac, and Xcode is already needed for iOS development, there’s no additional dependencies to download for development, or during CI/CD build.</p><h2 id="please-note">Please Note</h2><p>I learned a lot of this stuff from <a href="https://medium.com/xcblog/xcodebuild-deploy-ios-app-from-command-line-c6defff0d8b8">this article</a>
back when I was first researching how to do this for my client. That article hasn’t been updated in a while, and so I can’t just send people directly to that article.
That’s why I wrote this one.</p>
</div><footer class="container mt-8 pt-2 border-solid border-dr-blue-1 border-t">

    <div class="container grid grid-cols-1 md:grid-cols-3 md:gap-8 ">

            <div class="">
                <p>Interested in working together? I'd love to hear from you. Contact me <a href="mailto:daniel@danramteke.com">daniel at
                        danramteke dot com</a>.</p>

            </div>
            <div class="">
                <p>
                   <img src="/hi.png" width="220" height="220">
                </p>
            </div>

            <div class="">
             
             <ul class="list-group ">               
              
<div>
    Twitter: <a href="https://twitter.com/danramteke">danramteke</a>
</div>
<div>
    GitHub: <a href="https://github.com/danramteke">danramteke</a>
</div>
<div>
    Instagram: <a href="https://instagram.com/danramteke">danramteke</a>
</div>
<div>
    LinkedIn: <a href="http://linkedin.com/in/danielramteke">danielramteke</a>
</div>
              <li><a href="/resume.html">Resume</a></li>
             </ul>

            </div>
      
    </div>  
</footer>

  <p>© Daniel Ramteke 2022</p>
</div>




</body></html>