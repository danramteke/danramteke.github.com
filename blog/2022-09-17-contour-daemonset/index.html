<!DOCTYPE html><html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="geo.placename" content="New York City">
    <meta name="geo.region" content="US-NY">
    <meta name="description" content="Freelance iOS App Developer for New York City">
    <meta name="keywords" content="nyc, new york city, ios, swift, iphone, developer, programmer, engineer, freelance, contractor, devops, kubernetes, digitalocean, docker, terraform, xcode, subway, transit, graphics, design">
    <meta name="author" content="Daniel Ramteke">
    <title>Kubernetes without Load Balancers with Contour :: Daniel Ramteke iOS, DevOps, and web development in New York City</title>

<link rel="stylesheet" href="/assets/6b960ed9.59ee9b53.css" /></head>
<body class="bg-sky-100 text-sky-900 ">

<div class="sm:sticky sm:top-0 sm:flex sm:justify-between sm:items-center bg-neutral-800 text-blue-50 py-2">
  <div class="text-3xl font-bold px-8"><a href="/">Daniel Ramteke</a></div>


  <div class="sm:flex px-4">

    <a href="/resume" class="px-4 hover:bg-sky-900 hover:text-white text-sky-50 corner-2 rounded-full">
      Resume
    </a>

    <a href="/testimonials" class="px-4 hover:bg-sky-900 hover:text-white text-sky-50 corner-2 rounded-full">
      Testimonials
    </a>

    <a href="/press" class="px-4 hover:bg-sky-900 hover:text-white text-sky-50 corner-2 rounded-full">
      Press
    </a>

    <a href="/contact" class="px-4 hover:bg-sky-900 hover:text-white text-sky-50 corner-2 rounded-full">
      Contact
    </a>
  </div>

</div>

<div>
<div class="px-8 container">
    <div class="prose mt-8
prose-a:text-red-600 prose-a:no-underline
hover:prose-a:text-red-400 hover:prose-a:underline hover:prose-a:decoration-2

prose-h1:font-sans
prose-h2:font-sans
prose-h3:font-sans
prose-h4:font-sans
prose-h5:font-sans
prose-h6:font-sans
prose-strong:font-sans">
 <h1 id="kubernetes-without-load-balancers-with-contour">Kubernetes without Load Balancers with Contour</h1>
<p>For small projects, when the cost of a load balancer can cost as much as a smaller node, a load balancer can feel like overkill. I would prefer to have another compute node instead! But I still want the other benefits of Kubernetes. This is the work around I’ve done on for <a href="https://www.digitalocean.com?refcode=cb0365f6b163">DigitalOcean (referral link)</a>’s Kubernetes aka DOKS.</p>
<h2 id="single-node">Single node</h2>
<p>Start with the raw Contour yaml available from their GitHub: <a href="https://raw.githubusercontent.com/projectcontour/contour/v1.22.1/examples/render/contour.yaml">v1.22.1/…/contour.yaml</a> then search for a <code>Service</code> with <code>name: envoy</code>,</p>
<p>For the <code>Service</code>, change the <code>type</code> from <code>LoadBalancer</code> to <code>NodePort</code>.</p>
<p>If you only have one node, you’re done! You can point your <a href="https://www.digitalocean.com?refcode=cb0365f6b163">DigitalOcean (referral link)</a> <code>ReservedIP</code> to this node.</p>
<h2 id="more-than-one-node">More than one node</h2>
<p>If you have more than one Node, I use a <code>nodeSelector</code> and a label to specify an “edge” node.</p>
<p>Find a <code>DaemonSet</code> with <code>name: envoy</code>, add a <code>nodeSelector</code> key to the <code>spec.template.spec</code> dictionary. It will be a sibling of the <code>containers</code> key. It could look like this:</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #c9d1d9">spec:</span></span>
<span class="line"><span style="color: #c9d1d9">  # …</span></span>
<span class="line"><span style="color: #c9d1d9">  template:</span></span>
<span class="line"><span style="color: #c9d1d9">    # …</span></span>
<span class="line"><span style="color: #c9d1d9">    spec:</span></span>
<span class="line"><span style="color: #c9d1d9">      nodeSelector:</span></span>
<span class="line"><span style="color: #c9d1d9">        node-role: edge</span></span>
<span class="line"><span style="color: #c9d1d9">      containers:</span></span>
<span class="line"><span style="color: #c9d1d9">      # …</span></span></code></pre>
<p>Then, looking at your cluster, find the <code>Node</code> you want to use as the edge node. And run something like this <code>kubectl label node $edgeNodeName node-role=edge --overwrite</code></p>
<p>You can now point your <a href="https://www.digitalocean.com?refcode=cb0365f6b163">DigitalOcean (referral link)</a> <code>ReservedIP</code> to this node.</p>
<h2 id="apply">Apply</h2>
<p>Now you can apply your modified <code>contour.yaml</code>! Now you have a nice Ingress controller with nice features. You can spend your budget on compute instead of a load balancer.</p>
<h2 id="notes">Notes</h2>
<p>This is a more brittle setup for sure. If <a href="https://www.digitalocean.com?refcode=cb0365f6b163">DigitalOcean (referral link)</a> ever recreates your cluster for you, they will usually create a Load Balancer for you. Just remember to delete it.</p>
<p>Also, this setup can’t really do in-place upgrades. So instead, when you need to upgrade your Kubernetes version, setup a second cluster with your apps, swap your ReservedIP to that cluster, then delete your old one.</p>
<p><a href="https://www.digitalocean.com/?refcode=cb0365f6b163"><img src="https://web-platforms.sfo2.cdn.digitaloceanspaces.com/WWW/Badge%201.svg" alt="DigitalOcean Referral Badge"></a></p>
</div>
  </div>
</div>

<footer class=" mt-8 pt-2 border-solid bg-sky-900  border-t px-8 text-slate-300 ">
    <p class="py-8"><a href="/" class="hover:underline">&copy;2023 Daniel Ramteke</a> </p>
</footer>
</body></html>